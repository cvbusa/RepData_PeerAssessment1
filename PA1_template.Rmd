---
title: 'Reproducible Research: Peer Assessment 1'
output:
  html_document:
    keep_md: yes
  pdf_document: default
---


## Loading and preprocessing the data
```{r}
strUrl <-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
strFile <-"activity.zip"
if (!file.exists(strFile))
{
     download.file(url = strUrl, destfile = "activity.zip", method = "curl", mode = "wb")  
}
lstFiles <-unzip(zipfile = strFile)
#
df <-read.csv(file = lstFiles[1], colClasses = c("integer","character","integer"))
#
str(df)
#
df$interval.ori <-df$interval
df$interval <-sprintf(fmt = "%04d", df$interval)
#
df$date.ori <-df$date
df$date <-as.Date(df$date)
#
df$dayofweek <-weekdays(df$date)
#
df$daytype <-"weekday"
df[substr(df$dayofweek,1,1) == "S", "daytype"] <-"weekend"
df$daytype <-factor(df$daytype, levels = c("weekday","weekend"))
#
str(df)
```

## What is mean total number of steps taken per day?
```{r, TotalStepsPerDay}
# 1. Calculae the total number of steps taken per day
TotalStepsPerDay <-tapply(X = df$steps, INDEX = df$date, FUN = sum, na.rm = TRUE)
head(TotalStepsPerDay, n = 25)
# 2. Make a histogram of the total number of steps taken each day.
hist(x = TotalStepsPerDay, breaks = 60)
# 3. Calculae and report the mean and the median of the total number of steps taken per day.
(meanTotalStepsPerDay <-mean(TotalStepsPerDay))
(medianTotalStepsPerDay <-median(TotalStepsPerDay))
```



## What is the average daily activity pattern?
```{r, AvgStepsPerInterval}
AvgStepsPerInterval <-tapply(X = df$steps, INDEX = df$interval, FUN = mean, na.rm = TRUE)
head(AvgStepsPerInterval, n = 25)
# 1. Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
plot(names(AvgStepsPerInterval), AvgStepsPerInterval,type = "l")
# 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
(maxAvgStepsPerInterval <-AvgStepsPerInterval[AvgStepsPerInterval == max(AvgStepsPerInterval)])
```

## Imputing missing values
```{r, ImputMissingValues}
# 1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)
sum(!complete.cases(df))
sum(is.na(df$steps))
# 2. Devise a strategy for filling in all of the missing values in the dataset.
# create data frame "dfc" of complete case
dfc <-df[complete.cases(df),]
# create matrix of avg steps by interval (row name) and day of week (column name)
dfcmatrix <-tapply(X = dfc$steps, INDEX = list(dfc$interval,dfc$dayofweek), mean, na.rm = TRUE)
# 3. Create a new dataset that is equal to the original dataset but with missing data filled in.
# make copy of original steps variable
df$steps.ori <-df$steps
# loop through original data frame "df" and replace NA steps with avg steps from dfcmatrix
for (i in 1:nrow(df))
{
     isteps <-df[i,"steps"]
     iinterval <-df[i,"interval"]
     idayofweek <-df[i,"dayofweek"]
     # if steps is missing, replace with avg from dfcmatrix
     if(is.na(isteps))
     {
          df[i,"steps"] <-dfcmatrix[iinterval,idayofweek]
     }
}
# 4. Make a histogram of the total number of steps taken each day and calculate the mean and median total number of steps taken per day.
TotalStepsPerDay.na.rm <-tapply(X = df$steps, INDEX = df$date, FUN = sum, na.rm = TRUE)
# histogram
hist(x = TotalStepsPerDay.na.rm, breaks = 60)
# mean and median
meanTotalStepsPerDay.na.rm <-mean(TotalStepsPerDay.na.rm)
medianTotalStepsPerDay.na.rm <-median(TotalStepsPerDay.na.rm)
# compare with mean before inputing missing values
meanTotalStepsPerDay
meanTotalStepsPerDay.na.rm
(meanDiff <-meanTotalStepsPerDay.na.rm - meanTotalStepsPerDay)
# compare with median before inputing missing values
medianTotalStepsPerDay
medianTotalStepsPerDay.na.rm
(medianDiff <-medianTotalStepsPerDay.na.rm - medianTotalStepsPerDay)
```


## Are there differences in activity patterns between weekdays and weekends?
```{r, WeekdayWeekendDifference}
df$dayofweek <-weekdays(df$date)
# 1. Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or a weekend day.
df$daytype <-"weekday"
df[substr(df$dayofweek,1,1) == "S", "daytype"] <-"weekend"
df$daytype <-factor(df$daytype, levels = c("weekday","weekend"))
# 2. Make a panel plot containg a time serie plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged accors all weekdays or weekend days (y-axis)
# average number of steps taken per interval per daytype - weekday & weekend
mxAvgStepsPerIntervalByDayType <-tapply(X = df$steps, INDEX = list(df$interval, df$daytype), FUN = mean, na.rm = TRUE)
str(mxAvgStepsPerIntervalByDayType)
#
require(reshape2)
dfnew <-melt(data = mxAvgStepsPerIntervalByDayType, measure.vars = c("weekday","weekend"), id.vars = c("interval"))
names(dfnew) <-c("timeInterval","dayType","avgSteps")
str(dfnew)
#
require("lattice")
xyplot(avgSteps ~ timeInterval | dayType, data = dfnew, type = "l", layout = c(1,2), xlab = "Interval", ylab = "Avg Steps Per Interval" )
```

